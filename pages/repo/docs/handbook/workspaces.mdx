import Callout from "../../../../components/Callout";
import HeartIcon from "@heroicons/react/solid/HeartIcon";
import { Tabs, Tab } from "../../../../components/Tabs";

# 工作空间(workspaces)

// TODO 这句不知道怎么翻
Workspaces are the building blocks of your monorepo. Each app and package you add to your monorepo will be **inside its own workspace**.

工作区由您的 [包管理器](/repo/docs/handbook/package-installation) 管理，因此请确保您已先进行设置。

## 配置工作空间(workspaces)

要使用工作区，您必须首先向您的包管理器声明它们的文件位置。

我们推荐的一个常见约定是拥有顶级 `apps/` 和 `packages/` 目录。 这不是要求 - 只是建议的目录结构。

`apps` 文件夹应包含可启动应用程序的工作区，例如 [Next.js](https://nextjs.org/) 或 [Svelte](https://svelte.dev/) 应用程序。

`packages` 文件夹应该包含应用程序或其他包使用的包的工作区。

<Tabs items={['npm', 'yarn', 'pnpm']} storageKey="selected-pkg-manager">
  <Tab>

    将要配置为工作区的文件夹添加到根 `package.json` 文件中的 `workspaces` 字段。 此字段包含 glob 形式的工作区文件夹列表：

    ```json
    {
      "name": "my-monorepo",
      "version": "1.0.0",
      "workspaces": [
        "docs",
        "apps/*",
        "packages/*"
      ]
    }
    ```

  </Tab>
  <Tab>

    将要配置为工作区的文件夹添加到根 `package.json` 文件中的 `workspaces` 字段。 此字段包含 glob 形式的工作区文件夹列表：

    ```json
    {
      "name": "my-monorepo",
      "version": "1.0.0",
      "workspaces": [
        "docs",
        "apps/*",
        "packages/*"
      ]
    }
    ```

  </Tab>

  <Tab>

    将要配置为工作空间的文件夹添加到根目录中的 `pnpm-workspace.yaml` 文件中。 此文件包含 glob 形式的工作区文件夹列表：

    ```yaml
    packages:
      - "docs"
      - "apps/*"
      - "packages/*"
    ```

  </Tab>
</Tabs>

```
my-monorepo
├─ docs
├─ apps
│  ├─ api
│  └─ mobile
├─ packages
│  ├─ tsconfig
│  └─ shared-utils
└─ sdk
```

在上面的示例中，`my-monorepo/apps/` 和 `my-monorepo/packages/` 中的所有目录都是工作空间(workspaces)，而 `my-monorepo/docs` 目录本身也是工作空间(workspaces)。 `my-monorepo/sdk/` _不是_ 工作空间(workspaces)，因为它不包含在工作空间(workspaces)配置中。

## 命名工作空间(workspaces)

每个工作区都有一个唯一的名称，在其 `package.json` 中指定：

```json filename="packages/shared-utils/package.json"
{
  "name": "shared-utils"
}
```

此名称用于：

1. 指定[包应该安装到]（/repo/docs/handbook/package-installation）的工作区
2. 在其他工作区使用这个工作区
3. [发布包](/repo/docs/handbook/publishing-packages)：它将以您指定的`name`在npm上发布

您可以使用 npm 组织或用户范围来避免与 npm 上的现有包发生冲突。 例如，您可以使用 `@mycompany/shared-utils`。

## 相互依赖的工作空间(workspaces)

要在一个工作空间(workspaces)中使用另一个工作空间(workspaces)，您需要使用其名称将其指定为依赖项。

例如，如果我们希望 `apps/docs` 导入 `packages/shared-utils`，我们需要在 `apps/docs/package.json` 中添加 `shared-utils` 作为依赖项：

<Tabs items={['npm', 'yarn', 'pnpm']} storageKey="selected-pkg-manager">
  <Tab>

```json filename="apps/docs/package.json"
{
  "dependencies": {
    "shared-utils": "*"
  }
}
```

  </Tab>
  <Tab>
```json filename="apps/docs/package.json"
{
  "dependencies": {
    "shared-utils": "*"
  }
}
```

  </Tab>

  <Tab>
```json filename="apps/docs/package.json"
{
  "dependencies": {
    "shared-utils": "workspace:*"
  }
}
```

  </Tab>
</Tabs>

<Callout type="info">
  `*` 表示允许我们引用依赖项的 _latest_ 版本。 它使我们无需修改依赖项的版本，如果版本发生了变化，每次安装依赖时都会使用最新的版本
</Callout>

就像一个普通的包一样，我们之后需要从根目录运行 `install`。 安装后，我们可以像使用 `node_modules` 中的任何其他包一样使用工作空间(workspaces)。有关更多信息，请参阅我们的 [关于共享代码的部分](/repo/docs/handbook/sharing-code)。

## 管理工作空间(workspaces)

在 monorepo 中，当您从 root 运行 `install` 命令时，会发生一些事情：

1. 检查你已经安装的 工作空间(workspace) 依赖项
2. 任何工作空间都会 [链接](https://en.wikipedia.org/wiki/Symbolic_link) 到 `node_modules` 中，这意味着您可以像普通包一样导入它们
3. 其他包下载安装到 `node_modules`

这意味着无论何时添加/删除工作空间(workspaces)，或更改它们在文件系统上的位置，您都需要从根目录重新运行 `install` 命令以再次设置工作空间(workspaces)。

<Callout>
  您**不需要在每次源代码更改时重新安装**包 - 仅当您以某种方式更改工作空间(workspaces)的位置（或配置）时。
</Callout>

如果遇到问题，您可能必须删除存储库中的每个 `node_modules` 文件夹并重新运行 `install` 以修复它。
