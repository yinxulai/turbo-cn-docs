import { Tabs, Tab } from "../../../../components/Tabs";
import Callout from "../../../../components/Callout";

# 在 Monorepo 中测试

除了 linting 和构建，测试是生产就绪的 monorepo 的关键部分。 无论您使用的是端到端测试还是单元测试套件，将它们与 Turborepo 集成都会带来巨大的加速。

## 与测试运行器一起工作

假设我们有一个如下所示的 monorepo：

```
├── apps
│   └── web
│       └── package.json
└── packages
    └── shared
        └── package.json
```

`apps/web` 和 `packages/shared` 都有自己的测试套件。 他们的 `package.json` 文件如下所示：

<Tabs items={["Jest", "Vitest"]} storageKey="selected-test-runner">
  <Tab>
```json filename="apps/web/package.json"
{
  "scripts": {
    "test": "jest"
  }
}
```
  </Tab>
  <Tab>
```json filename="apps/web/package.json"
{
  "scripts": {
    "test": "vitest run"
  }
}
```
    </Tab>
</Tabs>

在根 `turbo.json` 中，我们建议在您的 [管道](/repo/docs/core-concepts/running-tasks) 中设置 `test` 任务：

```json filename="turbo.json"
{
  "pipeline": {
    "test": {
      "outputs": []
    }
  }
}
```

现在，在你的根 `package.json` 中，添加一个 `test` 脚本：

```json filename="package.json"
{
  "scripts": {
    "test": "turbo run test"
  }
}
```

现在，您可以使用包管理器运行 `test` 并让 Turborepo 测试整个存储库。

由于 Turborepo 的 [caching](/repo/docs/core-concepts/caching)，这也意味着只测试已更改文件的存储库 - 从而节省了大量时间。

## 在 Watch 模式下运行测试

当您正常运行测试套件时，它会完成并输出到“stdout”。 这意味着您可以使用 Turborepo [缓存它](/repo/docs/core-concepts/caching)。

但是当您在监视模式下运行测试时，该过程永远不会退出。 这使得监视任务更像 [开发任务](/repo/docs/handbook/dev)。

由于这种差异，我们建议指定**两个单独的 Turborepo 任务**：一个用于运行测试，另一个用于在监视模式下运行它们。

这是一个例子：

<Tabs items={["Jest", "Vitest"]} storageKey="selected-test-runner">
  <Tab>
```json filename="apps/web/package.json"
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```
  </Tab>
  <Tab>
```json filename="apps/web/package.json"
{
  "scripts": {
    "test": "vitest run",
    "test:watch": "vitest"
  }
}
```
    </Tab>
</Tabs>

```json filename="turbo.json"
{
  "pipeline": {
    "test": {
      "outputs": []
    },
    "test:watch": {
      "cache": false
    }
  }
}
```

```json filename="package.json"
{
  "scripts": {
    "test": "turbo run test",
    "test:watch": "turbo run test:watch"
  }
}
```
