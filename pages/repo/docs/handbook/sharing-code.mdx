import Callout from "../../../../components/Callout";

# 在 monorepo 中共享代码

Monorepos 可让您跨应用程序共享代码而不会产生摩擦。为此，您将构建 **packages** 以在您的应用程序之间共享代码。

##什么是包？

当涉及到 monorepos 时，“包”这个词有双重含义。它可以引用以下任何一个：

1. 通过像 `npm` 之类的包管理器，您从注册表下载到您的 `node_modules` 的一组文件。
2. 一个包含可以在应用程序之间共享的代码的工作区——按照惯例，通常在 `/packages` 中。

对于刚接触 monorepo 场景的人来说，这种双重含义可能会非常令人困惑。您可能对 [包安装](/repo/docs/handbook/package-installation) 非常熟悉，但对 [workspaces](/repo/docs/handbook/workspaces) 不太熟悉。

事实是它们非常相似。包只是一段共享代码。除了 _installed packages_ 存在于您的 `node_modules` 中，而 _local packages_ 存在于工作空间中 - 可能在您的 `/packages` 文件夹中。

## 封装剖析

每个包都包含一个`package.json`。您可能熟悉使用这些来管理应用程序中的依赖项和脚本。

但是，您之前可能没有注意到 `main` 和 `name` 字段：

```jsonc filename="packages/my-lib/package.json"
{
  // The name of your package
  "name": "my-lib",

  // When this package is used, this file is actually
  // the thing that gets imported
  "main": "./index.js"
}
```

这两个字段对于决定**此包在导入时的行为方式** 都很重要。 例如，如果 `index.js` 有一些导出：

```js filename="packages/my-lib/index.js"
export const myFunc = () => {
  console.log("Hello!");
};
```

我们将此文件导入我们的一个应用程序中：

```ts filename="apps/web/pages/index.jsx"
import { myFunc } from "my-lib";

myFunc(); // Hello!
```

然后我们就可以在我们的应用程序中使用 `my-lib` 文件夹中的代码了。

总而言之，**每个包都必须在其 `package.json` 中声明一个 `name` 和 `main`**。

<Callout type="info">

`package.json` 中的包解析是一个非常复杂的话题，我们在这里不能公正地处理它。 `package.json` 中的其他字段可能优先于 `main`，具体取决于导入包的方式。

查看 [npm 文档](https://docs.npmjs.com/cli/v8/configuring-npm/package-json#main) 获取指南。

就我们的目的而言，使用 `main` 就足够了。

</Callout>

## 下一步

我们将介绍两种样式的包 - **internal** 包和 **external** 包：

[**Internal** packages](/repo/docs/handbook/sharing-code/internal-packages) 旨在仅在它们所在的 monorepo 内部使用。 它们的设置相对简单，如果您的项目是封闭源代码，它们将对您最有用。

[**外部** 包](/repo/docs/handbook/publishing-packages) 被捆绑并发送到包注册表。 这对于设计系统、共享实用程序库或任何开源工作很有用。 但是，它们在捆绑、版本控制和发布方面引入了更多复杂性。
